version: 1.0
backend:
  phases:
    preBuild:
      commands:
        - cd packages/awsls
        #- if [ "${AWS_BRANCH}" = "feature/amplifyBackendBuild" ]; then amplifyPush --environment local; fi
        ##- if [ "${AWS_BRANCH}" = "develop" ]; then amplifyPush --environment local; fi
        ##- if [ "${AWS_BRANCH}" = "qa" ]; then amplifyPush --environment qa; fi
        ##- if [ "${AWS_BRANCH}" = "master" ]; then amplifyPush --environment prod; fi
    build:
      commands:
        - export STACKINFO="$(envCache --get stackInfo)"
        - if [ "${AWS_BRANCH}" = "feature/amplifyBackendBuild" ]; then amplifyPush --environment local; fi
        #- if [ "${AWS_BRANCH}" = "feature/amplifyBackendBuild" ]; then envCache --set stackInfo "$(amplify env get --json --name local)"; fi
        ##- if [ "${AWS_BRANCH}" = "qa" ]; then echo "qa branch"; fi
        ##- if [ "${AWS_BRANCH}" = "master" ]; then echo "master branch"; fi
frontend:
  phases:
    preBuild:
      commands:
        - npm install -g npm
        - npm install --global lerna
        - lerna bootstrap
        - cd ../students
        - npm install
    # IMPORTANT - Please verify your build commands
    build:
      commands:
        - npm run build
  artifacts:
    # IMPORTANT - Please verify your build output directory
    baseDirectory: packages/students/build
    files:
      - '**/*'
    discard-paths: yes
  cache:
    paths:
      - node_modules/**/*
